{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>
    {% block title %}E-CLOTHIFY{% endblock %} | E-CLOTHIFY
  </title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  {% block meta_description %}
  <meta name="description"
        content="E-CLOTHIFY, tienda de ropa personalizable: camisetas, sudaderas, gorras y pantalones con tu texto, color y estilo.">
  {% endblock %}

  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#ff9f1c">

  <!-- Open Graph bÃ¡sico -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="E-CLOTHIFY â€“ Ropa personalizable online">
  <meta property="og:description"
        content="DiseÃ±a tu propia ropa: camisetas, sudaderas, gorras y pantalones personalizados.">
  <meta property="og:image" content="{% static 'img/E-Clothify.png' %}">
  <meta property="og:locale" content="es_ES">

  <link rel="icon" href="{% static 'img/favicon.png' %}" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">



  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet">

  <style>
    :root {
      --ec-primary: #ff9f1c;
      --ec-primary-soft: rgba(255,159,28,0.15);
      --ec-bg: #020308;
      --ec-bg-card: #111419;
      --ec-text: #f5f5f5;
      --ec-muted: #a4a4a4;
    }

    body {
      min-height:100vh;
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--ec-text);
      background:
        radial-gradient(circle at top left,#1a1f2a 0,transparent 50%),
        radial-gradient(circle at bottom right,#141722 0,transparent 50%),
        var(--ec-bg);
    }

    a { color:var(--ec-primary); text-decoration:none; }
    a:hover { color:#ffd580; }

    .ec-navbar {
      backdrop-filter:blur(16px);
      background:linear-gradient(90deg,rgba(0,0,0,0.9),rgba(6,6,10,0.95));
      border-bottom:1px solid rgba(255,255,255,0.05);
    }

    .ec-logo { display:inline-flex; align-items:center; gap:.45rem;
               font-weight:700; letter-spacing:.06em; text-transform:uppercase;
               font-size:.95rem; color:#fff!important; }

    .ec-logo-badge {
      width:32px; height:32px; border-radius:999px;
      background:radial-gradient(circle at 30% 20%,#ffe9b0,#ff9f1c);
      display:inline-flex; align-items:center; justify-content:center;
      box-shadow:0 0 0 1px rgba(0,0,0,.4), 0 10px 25px rgba(0,0,0,.8);
    }

    .ec-main { max-width:1200px; margin:2.5rem auto 2rem; padding:1.5rem; }

    .ec-card {
      background: radial-gradient(circle at top left,
                  rgba(255,255,255,0.05) 0,
                  rgba(17,20,25,1) 50%);
      border-radius:24px;
      padding:1.75rem;
      box-shadow:0 30px 80px rgba(0,0,0,0.75),
                  0 0 0 1px rgba(255,255,255,0.02);
    }

    .ec-footer {
      border-top:1px solid rgba(255,255,255,0.05);
      font-size:.85rem;
      color:var(--ec-muted);
      padding:1.25rem 0 1.75rem;
      text-align:center;
    }

    /* ==== Mejora formularios: texto oscuro sobre fondos claros ==== */

    /* Labels siempre legibles */
    .form-label,
    .form-check-label {
      color: #111419;
    }

    /* Texto de inputs / selects */
    .form-control,
    .form-select,
    textarea.form-control {
      color: #111419;
      background-color: #ffffff;
    }

    /* Placeholders mÃ¡s visibles en blanco */
    .form-control::placeholder,
    textarea.form-control::placeholder {
      color: #6c757d;
      opacity: 1;
    }

        /* ==== Mensajes flash globales ==== */
    .flash-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
    }

    .flash {
      padding: 10px 18px;
      border-radius: 999px;
      margin-bottom: 8px;
      font-size: 0.9rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
      color: #0f172a;
    }

    .flash-success { background: #bbf7d0; }  /* verde suave */
    .flash-info    { background: #e0f2fe; }  /* azul clarito */
    .flash-error,
    .flash-danger  { background: #fee2e2; }  /* rojo clarito */

    .ec-footer .text-muted {
  color: #d5d5d5 !important;
}

    .ec-card .text-muted,
.ec-card small.text-muted,
.ec-card .small.text-muted {
  color: #e5e7eb !important;  /* gris clarito */
  opacity: 0.9;
}

/* Texto atenuado dentro de TARJETAS BLANCAS (catÃ¡logo) â†’ mÃ¡s oscuro */
.ec-card .card .text-muted,
.ec-card .card small.text-muted {
  color: #6c757d !important;   /* gris de Bootstrap por defecto */
  opacity: 1;
}



  </style>

  {% block extra_head %}{% endblock %}
</head>

<body class="{% block body_class %}{% endblock %}">

  {% if messages %}
    <div class="flash-container">
      {% for message in messages %}
        <div class="flash flash-{{ message.tags }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

<header class="ec-navbar sticky-top">
  <nav class="navbar navbar-expand-lg navbar-dark container">

    <a class="navbar-brand ec-logo"
   {% if user.is_authenticated and user.is_staff %}
       href="/gestion/"
   {% else %}
       href="{% url 'productos:catalogo' %}"
   {% endif %}
>
  <span class="ec-logo-badge">
    <img src="{% static 'img/E-Clothify.png' %}" alt="Logo" width="20">
  </span>
  <span>E-CLOTHIFY</span>
</a>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">

      <form class="d-flex ms-lg-4 my-3 my-lg-0 w-100" action="{% url 'productos:catalogo' %}">
        <input class="form-control form-control-sm me-2" type="search"
               name="q" placeholder="Buscar productos..." value="{{ q|default:'' }}">
        <button class="btn btn-sm btn-outline-light" type="submit">Buscar</button>
      </form>

      <ul class="navbar-nav ms-lg-4 mb-2 mb-lg-0 align-items-lg-center">

        {# ðŸ‘‡ Ocultamos catÃ¡logo / seguimiento / carrito en /gestion/ #}
        {% if request.path|slice:":9" != "/gestion/" %}

          <li class="nav-item">
            <a class="nav-link" href="{% url 'productos:catalogo' %}">CatÃ¡logo</a>
          </li>

          <li class="nav-item">
            {% if user.is_authenticated %}
              <a class="nav-link" href="{% url 'pedidos:mis_pedidos' %}">Seguimiento</a>
            {% else %}
              <a class="nav-link" href="#"
                 data-bs-toggle="modal" data-bs-target="#seguimientoModal">
                 Seguimiento
              </a>
            {% endif %}
          </li>

          <li class="nav-item ms-lg-3">
            <a class="btn btn-sm btn-outline-light position-relative"
               href="{% url 'carrito:carrito_ver' %}">ðŸ›’
              {% if cart_count %}
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                  {{ cart_count }}
                </span>
              {% endif %}
            </a>
          </li>

        {% endif %}

        <li class="nav-item ms-lg-3 mt-2 mt-lg-0">
          {% if user.is_authenticated %}
            {# El chip Hola, usuario es el enlace al perfil #}
            <a href="{% url 'accounts:perfil' %}" class="nav-link d-inline px-0">
              <span class="ec-chip me-2">Hola, {{ user.username }}</span>
            </a>
            <span class="text-muted mx-1">Â·</span>
            <a class="nav-link d-inline" href="{% url 'accounts:logout' %}">Salir</a>
          {% else %}
            <a class="nav-link d-inline" href="{% url 'accounts:login' %}">Entrar</a>
            <span class="text-muted mx-1">Â·</span>
            <a class="nav-link d-inline" href="{% url 'accounts:registro' %}">Crear cuenta</a>
          {% endif %}
        </li>

      </ul>
    </div>
  </nav>
</header>

<main class="ec-main">
  <div class="ec-card">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="h4 mb-0">{% block page_title %}{% endblock %}</h1>
        <small class="text-muted">{% block page_subtitle %}{% endblock %}</small>
      </div>
      {% block page_badge %}{% endblock %}
    </div>

    <div class="ec-content-inner">
      {% block content %}{% endblock %}
    </div>
  </div>
</main>

<footer class="ec-footer">
  Â© {% now "Y" %} E-CLOTHIFY â€” Todos los derechos reservados Â·
  <span class="text-muted">EnvÃ­o gratis desde 50,00 â‚¬</span>
</footer>

<!-- MODAL SEGUIMIENTO INVITADO -->
<div class="modal fade" id="seguimientoModal" tabindex="-1"
     aria-labelledby="seguimientoModalLabel" aria-hidden="true">

  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light">

      <div class="modal-header border-0">
        <h5 class="modal-title" id="seguimientoModalLabel">
          Introducir cÃ³digo de seguimiento
        </h5>
        <button type="button" class="btn-close btn-close-white"
                data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p class="small text-muted">
          Escribe el <strong>cÃ³digo</strong> o pega la <strong>URL completa</strong>
          que recibiste por correo.
        </p>

        <form id="formSeguimiento">
          <input type="text" id="inputSeguimiento"
                 class="form-control"
                 placeholder="Ej: ABC123 o URL completa">
          <div class="invalid-feedback">CÃ³digo no vÃ¡lido.</div>
        </form>
      </div>

      <div class="modal-footer border-0">
        <button class="btn btn-outline-light btn-sm" data-bs-dismiss="modal">Cerrar</button>
        <button class="btn btn-warning btn-sm" id="btnSeguimientoIr">Ver pedido</button>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const input = document.getElementById("inputSeguimiento");
  const btn   = document.getElementById("btnSeguimientoIr");
  const form  = document.getElementById("formSeguimiento");

  if (!input || !btn || !form) return;

  // PatrÃ³n para construir URL con token
  const PATTERN_TOKEN = "{% url 'pedidos:seguimiento' token='__TOKEN__' %}";
  // PatrÃ³n para construir URL con ID (usamos 0 y luego lo sustituimos)
  const PATTERN_ID = "{% url 'pedidos:seguimiento_id' pedido_id=0 %}".replace("0", "__ID__");

  function extractToken(v) {
    v = (v || "").trim();
    if (!v) return "";

    // Si es URL completa, sacamos el Ãºltimo segmento
    if (v.startsWith("http://") || v.startsWith("https://")) {
      try {
        const u = new URL(v);
        const parts = u.pathname.split("/").filter(Boolean);
        return parts[parts.length - 1] || "";
      } catch(e){}
    }

    // Si viene con /pedidos/seguimiento/ en medio
    const idx = v.toLowerCase().indexOf("/pedidos/seguimiento/");
    if (idx !== -1) {
      let sub = v.slice(idx + "/pedidos/seguimiento/".length);
      return sub.replace(/\/+.*/, "");
    }

    // Si no, asumimos que es el propio token sin adornos
    return v.replace(/^\/+|\/+$/g, "");
  }

  function go() {
    const raw = (input.value || "").trim();
    if (!raw) {
      input.classList.add("is-invalid");
      return;
    }

    // Si son solo dÃ­gitos -> lo tratamos como ID de pedido
    if (/^\d+$/.test(raw)) {
      const url = PATTERN_ID.replace("__ID__", raw);
      window.location.href = url;
      return;
    }

    // Si no, extraemos token como antes
    const token = extractToken(raw);
    if (!token) {
      input.classList.add("is-invalid");
      return;
    }

    const url = PATTERN_TOKEN.replace("__TOKEN__", encodeURIComponent(token));
    window.location.href = url;
  }

  btn.onclick = e => { e.preventDefault(); go(); };
  form.onsubmit = e => { e.preventDefault(); go(); };
  input.oninput = () => input.classList.remove("is-invalid");

});
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      document.querySelectorAll('.flash').forEach(el => el.remove());
    }, 4000);
  });
</script>


{% block extra_js %}{% endblock %}
</body>
</html>
