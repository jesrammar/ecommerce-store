{% extends "base.html" %}
{% load static %}
{% block title %}Entrar{% endblock %}
{% block body_class %}auth-bg{% endblock %}

{% block extra_head %}
<style>
 
  .auth-bg{
  min-height:100vh;
  max-height:100vh;           /* opcional, para que el fondo no crezca infinito */
  background:
    radial-gradient(circle at center, rgba(0,0,0,.45), rgba(0,0,0,.92) 80%),
    url("{% static 'img/E-Clothify.png' %}") center/480px no-repeat,
    linear-gradient(180deg, #141516, #0b0c0d);
  background-blend-mode: overlay;
  position: relative;
  overflow-y: auto;           /* ✅ permite scroll vertical */
  overflow-x: hidden;         /* opcional, por si aparece barra horizontal fea */
}


  /* Ocultamos el enlace de seguimiento en el login */
  .navbar .nav-link[data-bs-target="#seguimientoModal"] {
    display: none !important;
  }

  .auth-bg::before{
    content:"";
    position:fixed;
    inset:0;
    background:
      url("{% static 'img/E-Clothify.png' %}") center/520px no-repeat;
    opacity:.05;
    filter: blur(14px);
    pointer-events:none;
  }

  .auth-wrap{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }

  .glass-card{
    width:100%;
    max-width:480px;
    backdrop-filter: blur(10px);
    background: radial-gradient(circle at top, rgba(255,255,255,.06), rgba(0,0,0,.92) 60%);
    border:1px solid rgba(255,255,255,.12);
    border-radius:24px;
    box-shadow:0 18px 45px rgba(0,0,0,.7);
    color:#f5f6f7;
  }

  .glass-card .form-control{
    background: rgba(0,0,0,.45);
    border:1px solid rgba(255,255,255,.2);
    color:#fff;
    border-radius:999px;
    height:42px;
    font-size:.95rem;
  }
  .glass-card .form-control::placeholder{ color:#d0d0d0; }

  .glass-card .form-control:focus{
    box-shadow: 0 0 0 .18rem rgba(255,152,0,.35);
    border-color:#ff9800;
    background: rgba(0,0,0,.65);
  }

  .brand-top{ display:flex; align-items:center; gap:.6rem; margin-bottom:.25rem; }
  .brand-top img{ height:36px; width:auto; }
  .brand-top .brand-text{ line-height:1; position:relative; top:1px; }

  .muted{ color:#cfd3d8; opacity:.85; font-size:.9rem; }

  .btn-auth-primary{
    background:#ff9800;
    border:none;
    border-radius:999px;
    font-weight:600;
  }
  .btn-auth-primary:hover{ filter:brightness(.96); }

  /* Botón para entrar como invitado */
  .btn-auth-guest{
    border-radius:999px;
    font-weight:500;
    border:1px solid rgba(255,255,255,.4);
    background: transparent;
    color:#f5f6f7;
  }
  .btn-auth-guest:hover{
    background: rgba(255,255,255,.08);
    color:#fff;
  }

  a.link-light{ color:#fff; opacity:.9; }
  a.link-light:hover{ opacity:1; }

  .small-error{ font-size:.8rem; }

  .auth-bg .text-muted {
  color: #e6e6e6 !important;
  opacity: .9 !important;
}

</style>
{% endblock %}

{% block content %}
<div class="auth-wrap">
  <div class="glass-card p-4 p-md-5">
    <form method="post" novalidate>
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ next }}">

      <div class="brand-top mb-3">
        <img src="{% static 'img/E-Clothify.png' %}" alt="E-Clothify">
        <span class="brand-text fw-bold text-uppercase" style="letter-spacing:.08em;">
          E-Clothify
        </span>
      </div>

      <h2 class="h4 mb-1">Bienvenido</h2>
      <p class="muted mb-3">
        Accede con tu cuenta o compra como invitado.
      </p>

      {% if form.non_field_errors %}
        <div class="alert alert-danger py-2 mb-2">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      

      <div class="mb-2">
        <label class="form-label mb-1" for="id_username">Usuario o email</label>
        <input id="id_username" type="text" name="username" class="form-control"
               required autocomplete="username" autofocus
               placeholder="tu usuario" value="{{ request.POST.username }}">
      </div>

      <div class="mb-3">
        <label class="form-label mb-1" for="id_password">Contraseña</label>
        <input id="id_password" type="password" name="password" class="form-control"
               required autocomplete="current-password" placeholder="••••••••">
      </div>

      <button class="btn btn-auth-primary w-100 py-2">Entrar</button>

      {# --- Bloque nuevo: entrar como invitado --- #}
      <div class="mt-3">
        <a href="{% url 'productos:catalogo' %}"
           class="btn btn-auth-guest w-100 py-2">
          Entrar como invitado
        </a>
      </div>

      <p class="text-center mt-3 mb-0" style="font-size:.9rem;">
        ¿No tienes cuenta?
        <a href="{% url 'accounts:registro' %}" class="link-light text-decoration-underline">
          Crear cuenta
        </a>
      </p>

      <p class="text-center mt-2 mb-0 text-muted" style="font-size:.8rem;">
        Como invitado podrás realizar una compra completa sin registrarte.
        Si creas una cuenta, podrás guardar tus datos y consultar el historial de pedidos.
      </p>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Parallax suave del fondo
  const bg = document.querySelector('.auth-bg');
  let targetX = 0, targetY = 0;
  let currentX = 0, currentY = 0;

  document.addEventListener('mousemove', e => {
    targetX = (e.clientX / window.innerWidth - 0.5) * 15;
    targetY = (e.clientY / window.innerHeight - 0.5) * 15;
  });

  function animate() {
    currentX += (targetX - currentX) * 0.05;
    currentY += (targetY - currentY) * 0.05;
    if (bg) {
      bg.style.backgroundPosition =
        `calc(50% + ${currentX}px) calc(50% + ${currentY}px)`;
    }
    requestAnimationFrame(animate);
  }
  animate();
</script>
{% endblock %}
