{% extends "base.html" %}
{% block title %}Mi perfil{% endblock %}
{% block page_title %}Mi perfil{% endblock %}
{% block page_subtitle %}Gestiona tus datos personales y direcciones de envío.{% endblock %}

{% block content %}
<div class="row g-4">
  <!-- Datos de cuenta -->
  <div class="col-lg-5">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <h2 class="h6 text-uppercase text-muted mb-3">Datos de cuenta</h2>

        <form method="post" class="vstack gap-3" novalidate>
          {% csrf_token %}
          {% for field in form %}
            <div>
              <label class="form-label mb-1" for="{{ field.id_for_label }}">
                {{ field.label }}
              </label>
              {{ field }}
              {% if field.help_text %}
                <div class="form-text">{{ field.help_text }}</div>
              {% endif %}
              {% for error in field.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>
          {% endfor %}
          <button class="btn btn-primary w-100 mt-2">Guardar cambios</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Direcciones -->
  <div class="col-lg-7">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h2 class="h6 text-uppercase text-muted mb-1">Direcciones de envío</h2>
            <p class="small text-muted mb-0">
              Configura tus direcciones habituales para agilizar la compra.
            </p>
          </div>
          <a class="btn btn-sm btn-outline-success"
             href="{% url 'accounts:address_create' %}">
            Añadir dirección
          </a>
        </div>

        <div class="flex-grow-1">
          <ul class="list-group list-group-flush">
            {% for d in direcciones %}
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div>
                  <div class="fw-semibold">
                    {{ d.nombre }}
                    {% if d.es_predeterminada %}
                      <span class="badge rounded-pill text-bg-secondary ms-2">Predeterminada</span>
                    {% endif %}
                  </div>
                  <div class="small text-muted">
                    {{ d.linea1 }}{% if d.linea2 %}, {{ d.linea2 }}{% endif %}<br>
                    {{ d.cp }} {{ d.ciudad }}
                  </div>
                </div>
                <div class="btn-group btn-group-sm ms-3">
                  <a class="btn btn-outline-primary"
                     href="{% url 'accounts:address_edit' d.pk %}">Editar</a>
                  <a class="btn btn-outline-secondary"
                     href="{% url 'accounts:address_make_default' d.pk %}">Predet.</a>
                  <a class="btn btn-outline-danger"
                     href="{% url 'accounts:address_delete' d.pk %}">Eliminar</a>
                </div>
              </li>
            {% empty %}
              <li class="list-group-item text-muted">
                Sin direcciones aún. Añade al menos una dirección para poder usarla en tus pedidos.
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
